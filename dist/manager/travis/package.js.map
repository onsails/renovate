{"version":3,"file":"package.js","sourceRoot":"","sources":["../../../lib/manager/travis/package.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,0DAAkC;AAClC,sEAAoC;AACpC,iDAAkD;AAClD,mFAAqE;AACrE,yCAAsC;AACtC,6DAA6E;AAC7E,oDAA0E;AAGnE,KAAK,UAAU,iBAAiB,CACrC,MAA2B;IAE3B,eAAM,CAAC,KAAK,CAAC,4BAA4B,CAAC,CAAC;IAC3C,MAAM,EAAE,aAAa,EAAE,GAAG,MAAM,CAAC;IACjC,IAAI,EAAC,aAAa,aAAb,aAAa,uBAAb,aAAa,CAAE,MAAM,CAAA,EAAE;QAC1B,OAAO,EAAE,CAAC;KACX;IACD,MAAM,QAAQ,GAAG,sBAAW,EAAE,CAAC;IAC/B,KAAK,MAAM,MAAM,IAAI,aAAa,EAAE;QAClC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;YAC3C,eAAM,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,EAAE,uBAAuB,CAAC,CAAC;YACjD,OAAO,EAAE,CAAC;SACX;KACF;IACD,eAAM,CAAC,KAAK,CAAC,EAAE,aAAa,EAAE,EAAE,eAAe,CAAC,CAAC;IACjD,IAAI,QAAQ,GAAW,aAA0C;SAC9D,GAAG,CAAC,CAAC,MAAM,EAAE,EAAE,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;SACjC,MAAM,CAAC,CAAC,MAAM,EAAE,MAAM,EAAE,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,CAAC;SACrD,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;IACzB,MAAM,QAAQ,GAAW,QAAQ,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;IACvD,IAAI,MAAM,CAAC,aAAa,KAAK,KAAK,IAAI,kBAAS,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,EAAE;QACvE,MAAM,QAAQ,GAAG,CACf,MAAM,2BAAc,CAAC;YACnB,GAAG,MAAM;YACT,UAAU,EAAE,oBAAoB,CAAC,EAAE;YACnC,OAAO,EAAE,aAAa;SACvB,CAAC,CACH,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;QAC7C,QAAQ,GAAG,QAAQ;aAChB,GAAG,CAAC,MAAM,CAAC;aACX,GAAG,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,6BAAoB,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC,CAAC;KAC1D;IACD,IAAI,YAAE,CAAC,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,EAAE;QACrC,QAAQ,GAAG,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;KACjC;IACD,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;IAE/B,2CAA2C;IAC1C,MAAM,CAAC,YAAoB,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;IACnD,IAAI,yBAAK,CAAC,MAAM,CAAC,YAAY,EAAE,QAAQ,CAAC,EAAE;QACxC,OAAO,EAAE,CAAC;KACX;IACD,OAAO;QACL;YACE,QAAQ,EAAE,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC;YAC5B,QAAQ;YACR,OAAO,EAAE,IAAI;YACb,SAAS,EAAE,gCAAgC;SAC5C;KACF,CAAC;AACJ,CAAC;AAnDD,8CAmDC","sourcesContent":["import is from '@sindresorhus/is';\nimport equal from 'fast-deep-equal';\nimport { getPkgReleases } from '../../datasource';\nimport * as datasourceGithubTags from '../../datasource/github-tags';\nimport { logger } from '../../logger';\nimport { NodeJsPolicies, getPolicies } from '../../versioning/node/schedule';\nimport { getSatisfyingVersion, isVersion } from '../../versioning/semver';\nimport { LookupUpdate, PackageUpdateConfig } from '../common';\n\nexport async function getPackageUpdates(\n  config: PackageUpdateConfig\n): Promise<LookupUpdate[]> {\n  logger.trace('travis.getPackageUpdates()');\n  const { supportPolicy } = config;\n  if (!supportPolicy?.length) {\n    return [];\n  }\n  const policies = getPolicies();\n  for (const policy of supportPolicy) {\n    if (!Object.keys(policies).includes(policy)) {\n      logger.warn({ policy }, `Unknown supportPolicy`);\n      return [];\n    }\n  }\n  logger.debug({ supportPolicy }, `supportPolicy`);\n  let newValue: any[] = (supportPolicy as (keyof NodeJsPolicies)[])\n    .map((policy) => policies[policy])\n    .reduce((result, policy) => result.concat(policy), [])\n    .sort((a, b) => a - b);\n  const newMajor: number = newValue[newValue.length - 1];\n  if (config.rangeStrategy === 'pin' || isVersion(config.currentValue[0])) {\n    const versions = (\n      await getPkgReleases({\n        ...config,\n        datasource: datasourceGithubTags.id,\n        depName: 'nodejs/node',\n      })\n    ).releases.map((release) => release.version);\n    newValue = newValue\n      .map(String)\n      .map((value) => getSatisfyingVersion(versions, value));\n  }\n  if (is.string(config.currentValue[0])) {\n    newValue = newValue.map(String);\n  }\n  newValue.sort((a, b) => a - b);\n\n  // TODO: `config.currentValue` is a string!\n  (config.currentValue as any).sort((a, b) => a - b);\n  if (equal(config.currentValue, newValue)) {\n    return [];\n  }\n  return [\n    {\n      newValue: newValue.join(','),\n      newMajor,\n      isRange: true,\n      sourceUrl: 'https://github.com/nodejs/node',\n    },\n  ];\n}\n"]}